<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ingresar | WebControl Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: {
                50: "#f8f9fa",
                100: "#f1f3f5",
                200: "#e9ecef",
                300: "#dee2e6",
                400: "#ced4da",
                500: "#495057",
                600: "#343a40",
                700: "#212529",
                800: "#1a1d20",
                900: "#111315",
                950: "#0a0b0c",
              },
            },
          },
        },
      };
    </script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      @keyframes float {
        0%,
        100% {
          transform: translateY(0px) rotate(0deg);
        }
        33% {
          transform: translateY(-20px) rotate(3deg);
        }
        66% {
          transform: translateY(10px) rotate(-3deg);
        }
      }
      @keyframes slideInRight {
        from {
          opacity: 0;
          transform: translateX(30px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }
      @keyframes slideInLeft {
        from {
          opacity: 0;
          transform: translateX(-30px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }
      .animate-float {
        animation: float 6s ease-in-out infinite;
      }
      .animate-slide-right {
        animation: slideInRight 0.6s ease-out;
      }
      .animate-slide-left {
        animation: slideInLeft 0.6s ease-out;
      }
      .animate-fade-in {
        animation: fadeIn 0.8s ease-out;
      }
      .gradient-border {
        border: 2px solid transparent;
        background: linear-gradient(white, white) padding-box,
          linear-gradient(135deg, #3b82f6, #8b5cf6) border-box;
      }
      .glass-effect {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen">
    <!-- Background Decorations -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
      <div
        class="absolute top-20 left-10 w-72 h-72 bg-gray-900/5 rounded-full mix-blend-multiply filter blur-3xl animate-float"
      ></div>
      <div
        class="absolute top-40 right-20 w-80 h-80 bg-gray-800/5 rounded-full mix-blend-multiply filter blur-3xl animate-float"
        style="animation-delay: 2s"
      ></div>
      <div
        class="absolute -bottom-20 left-1/3 w-96 h-96 bg-gray-700/5 rounded-full mix-blend-multiply filter blur-3xl animate-float"
        style="animation-delay: 4s"
      ></div>
    </div>

    <div class="min-h-screen flex flex-col lg:flex-row relative">
      <!-- Brand Panel -->
      <section
        class="hidden lg:flex lg:w-1/2 relative overflow-hidden bg-gradient-to-br from-gray-900 via-gray-800 to-black text-white animate-slide-left"
      >
        <!-- Animated Grid Pattern -->
        <div class="absolute inset-0 opacity-10">
          <div
            class="absolute inset-0"
            style="
              background-image: linear-gradient(
                  rgba(255, 255, 255, 0.1) 1px,
                  transparent 1px
                ),
                linear-gradient(
                  90deg,
                  rgba(255, 255, 255, 0.1) 1px,
                  transparent 1px
                );
              background-size: 50px 50px;
            "
          ></div>
        </div>

        <!-- Floating Shapes -->
        <div
          class="absolute top-20 right-20 w-32 h-32 border-2 border-white/10 rounded-3xl rotate-12 animate-float"
        ></div>
        <div
          class="absolute bottom-32 left-20 w-24 h-24 border-2 border-white/10 rounded-full animate-float"
          style="animation-delay: 1s"
        ></div>
        <div
          class="absolute top-1/2 left-1/4 w-16 h-16 bg-white/5 rounded-2xl rotate-45 animate-float"
          style="animation-delay: 2.5s"
        ></div>

        <div class="relative z-10 flex flex-col justify-between p-12 w-full">
          <!-- Header -->
          <div class="space-y-8 animate-fade-in">
            <div class="flex items-center space-x-3">
              <div
                class="w-28 h-28 rounded-2xl bg-white/10 backdrop-blur-sm flex items-center justify-center shadow-xl border border-white/20 overflow-hidden"
                style="min-width:7rem;min-height:7rem;"
              >
                <img src="/static/img/webcontrol-logo.png" alt="WebControl Logo" class="w-full h-full object-cover" onerror="this.onerror=null;this.src='/static/img/webcontrol-logo.svg';">
              </div>
              <div>
                <h1 class="text-2xl font-bold">WebControl Studio</h1>
                <p class="text-white/70 text-sm">Professional CMS Platform</p>
              </div>
            </div>

            <div class="space-y-4">
              <h2 class="text-5xl font-bold leading-tight">
                Crea sitios web <span class="text-gray-300">increíbles</span> en
                minutos
              </h2>
              <p class="text-xl text-white/90 leading-relaxed">
                Gestiona múltiples negocios, centraliza métricas y publica
                directamente en GitHub Pages desde un solo panel de control.
              </p>
            </div>
          </div>

          <!-- Features -->
          <div class="space-y-5 animate-fade-in" style="animation-delay: 0.2s">
            <div
              class="flex items-start space-x-4 p-4 rounded-2xl bg-white/5 backdrop-blur-sm hover:bg-white/10 transition-all duration-300 transform hover:scale-105 border border-white/10"
            >
              <div
                class="w-12 h-12 rounded-xl bg-white flex items-center justify-center flex-shrink-0 shadow-lg"
              >
                <i class="fas fa-chart-line text-gray-900 text-lg"></i>
              </div>
              <div>
                <p class="text-white font-semibold text-lg">
                  Analytics en tiempo real
                </p>
                <p class="text-white/80 text-sm">
                  Monitorea visitas, conversiones y rendimiento de cada sitio
                  con dashboards interactivos.
                </p>
              </div>
            </div>

            <div
              class="flex items-start space-x-4 p-4 rounded-2xl bg-white/5 backdrop-blur-sm hover:bg-white/10 transition-all duration-300 transform hover:scale-105 border border-white/10"
            >
              <div
                class="w-12 h-12 rounded-xl bg-white flex items-center justify-center flex-shrink-0 shadow-lg"
              >
                <i class="fas fa-rocket text-gray-900 text-lg"></i>
              </div>
              <div>
                <p class="text-white font-semibold text-lg">
                  Deploy automático
                </p>
                <p class="text-white/80 text-sm">
                  Publica instantáneamente en GitHub Pages con integración CI/CD
                  y dominios personalizados.
                </p>
              </div>
            </div>

            <div
              class="flex items-start space-x-4 p-4 rounded-2xl bg-white/5 backdrop-blur-sm hover:bg-white/10 transition-all duration-300 transform hover:scale-105 border border-white/10"
            >
              <div
                class="w-12 h-12 rounded-xl bg-white flex items-center justify-center flex-shrink-0 shadow-lg"
              >
                <i class="fas fa-palette text-gray-900 text-lg"></i>
              </div>
              <div>
                <p class="text-white font-semibold text-lg">
                  Editor visual avanzado
                </p>
                <p class="text-white/80 text-sm">
                  Personaliza diseños con editor drag & drop, preview en tiempo
                  real y templates profesionales.
                </p>
              </div>
            </div>
          </div>

          <!-- Stats -->
          <div
            class="grid grid-cols-3 gap-6 mt-8 animate-fade-in"
            style="animation-delay: 0.4s"
          >
            <div class="text-center">
              <p class="text-4xl font-bold text-white">15+</p>
              <p class="text-white/70 text-sm mt-1">Sitios activos</p>
            </div>
            <div class="text-center">
              <p class="text-4xl font-bold text-white">99.9%</p>
              <p class="text-white/70 text-sm mt-1">Uptime</p>
            </div>
            <div class="text-center">
              <p class="text-4xl font-bold text-white">24/7</p>
              <p class="text-white/70 text-sm mt-1">Soporte</p>
            </div>
          </div>
        </div>

        <!-- Gradient Overlay -->
        <div
          class="absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-black/20 to-transparent"
        ></div>
      </section>

      <!-- Form Panel -->
      <section
        class="flex-1 flex items-center justify-center p-8 relative animate-slide-right"
      >
        <div class="w-full max-w-md">
          <!-- Mobile Logo -->
            <div
              class="lg:hidden flex items-center justify-center space-x-3 mb-8 animate-fade-in"
            >
              <div
                class="w-28 h-28 rounded-2xl bg-gray-900 flex items-center justify-center shadow-lg overflow-hidden"
                style="min-width:7rem;min-height:7rem;"
              >
              <img src="/static/img/webcontrol-logo.png" alt="WebControl Logo" class="w-full h-full object-cover" onerror="this.onerror=null;this.src='/static/img/webcontrol-logo.svg';">
            </div>
            <h1 class="text-2xl font-bold text-gray-900">WebControl Studio</h1>
          </div>

          <!-- Form Card -->
          <div
            class="bg-white rounded-3xl shadow-2xl p-8 border border-gray-200"
          >
            <!-- Header -->
            <div class="mb-8 animate-fade-in">
              <div
                class="inline-flex items-center px-3 py-1 rounded-full bg-gray-100 text-gray-700 text-sm font-semibold mb-4 border border-gray-200"
              >
                <i class="fas fa-shield-alt mr-2"></i>
                Acceso seguro
              </div>
              <h2 class="text-3xl font-bold text-gray-900 mb-2">
                ¡Bienvenido de vuelta!
              </h2>
              <p class="text-gray-600">
                Ingresa tus credenciales para acceder al panel de
                administración.
              </p>
            </div>

            <!-- Alert -->
            <div
              id="loginAlert"
              class="hidden mb-6 rounded-xl border-l-4 border-red-500 bg-red-50 p-4 animate-fade-in"
            >
              <div class="flex items-start">
                <i
                  class="fas fa-exclamation-circle text-red-500 mt-0.5 mr-3"
                ></i>
                <p
                  class="text-sm font-medium text-red-800"
                  id="alertMessage"
                ></p>
              </div>
            </div>

            <!-- Form -->
            <form id="loginForm" class="space-y-6">
              <!-- Email Field -->
              <div class="animate-fade-in" style="animation-delay: 0.1s">
                <label
                  for="email"
                  class="block text-sm font-semibold text-gray-700 mb-2"
                >
                  Correo electrónico
                </label>
                <div class="relative group">
                  <div
                    class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"
                  >
                    <i
                      class="fas fa-envelope text-gray-400 group-focus-within:text-gray-900 transition-colors"
                    ></i>
                  </div>
                  <input
                    type="email"
                    id="email"
                    name="username"
                    required
                    autocomplete="email"
                    class="block w-full pl-11 pr-4 py-3.5 text-gray-900 border-2 border-gray-200 rounded-xl focus:border-gray-900 focus:ring-4 focus:ring-gray-100 transition-all duration-200 placeholder-gray-400"
                    placeholder="admin@webcontrol.com"
                  />
                </div>
              </div>

              <!-- Password Field -->
              <div class="animate-fade-in" style="animation-delay: 0.2s">
                <label
                  for="password"
                  class="block text-sm font-semibold text-gray-700 mb-2"
                >
                  Contraseña
                </label>
                <div class="relative group">
                  <div
                    class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"
                  >
                    <i
                      class="fas fa-lock text-gray-400 group-focus-within:text-gray-900 transition-colors"
                    ></i>
                  </div>
                  <input
                    type="password"
                    id="password"
                    name="password"
                    required
                    autocomplete="current-password"
                    class="block w-full pl-11 pr-12 py-3.5 text-gray-900 border-2 border-gray-200 rounded-xl focus:border-gray-900 focus:ring-4 focus:ring-gray-100 transition-all duration-200 placeholder-gray-400"
                    placeholder="••••••••••"
                  />
                  <button
                    type="button"
                    id="togglePassword"
                    class="absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-gray-900 transition-colors"
                  >
                    <i class="fas fa-eye"></i>
                  </button>
                </div>
              </div>

              <!-- Options -->
              <div
                class="flex items-center justify-between animate-fade-in"
                style="animation-delay: 0.3s"
              >
                <label class="flex items-center cursor-pointer group">
                  <input
                    id="rememberMe"
                    type="checkbox"
                    class="w-4 h-4 rounded border-gray-300 text-gray-900 focus:ring-2 focus:ring-gray-500 cursor-pointer"
                  />
                  <span
                    class="ml-2 text-sm text-gray-600 group-hover:text-gray-900"
                    >Recordar sesión</span
                  >
                </label>
                <a
                  href="https://github.com/AnSan29/webControl"
                  target="_blank"
                  class="text-sm font-semibold text-gray-700 hover:text-gray-900 flex items-center group"
                >
                  <span>Documentación</span>
                  <i
                    class="fas fa-external-link-alt ml-1.5 text-xs group-hover:translate-x-0.5 transition-transform"
                  ></i>
                </a>
              </div>

              <!-- Submit Button -->
              <button
                id="loginButton"
                type="submit"
                class="w-full relative group overflow-hidden rounded-xl bg-gray-900 px-6 py-3.5 font-semibold text-white shadow-lg hover:shadow-xl hover:bg-black focus:outline-none focus:ring-4 focus:ring-gray-300 transition-all duration-200 transform hover:scale-[1.02] active:scale-[0.98] animate-fade-in"
                style="animation-delay: 0.4s"
              >
                <span
                  class="relative z-10 flex items-center justify-center"
                  id="loginButtonText"
                >
                  <i class="fas fa-arrow-right-to-bracket mr-2"></i>
                  Iniciar sesión
                </span>
                <span
                  id="loginSpinner"
                  class="hidden relative z-10 flex items-center justify-center"
                >
                  <svg
                    class="animate-spin h-5 w-5 text-white"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                  >
                    <circle
                      class="opacity-25"
                      cx="12"
                      cy="12"
                      r="10"
                      stroke="currentColor"
                      stroke-width="4"
                    ></circle>
                    <path
                      class="opacity-75"
                      fill="currentColor"
                      d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                    ></path>
                  </svg>
                  <span class="ml-2">Autenticando...</span>
                </span>
                <div
                  class="absolute inset-0 bg-gray-700 opacity-0 group-hover:opacity-20 transition-opacity"
                ></div>
              </button>
            </form>

            <!-- Footer Info -->
            <div
              class="mt-8 pt-6 border-t border-gray-200 animate-fade-in"
              style="animation-delay: 0.5s"
            >
              <div
                class="flex items-center justify-center space-x-6 text-sm text-gray-500"
              >
                <div class="flex items-center">
                  <i class="fas fa-shield-halved text-gray-700 mr-1.5"></i>
                  <span>Seguridad JWT</span>
                </div>
                <div class="flex items-center">
                  <i class="fas fa-bolt text-gray-700 mr-1.5"></i>
                  <span>Deploy automático</span>
                </div>
                <div class="flex items-center">
                  <i class="fas fa-headset text-gray-700 mr-1.5"></i>
                  <span>Soporte 24/7</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Additional Info -->
          <p
            class="mt-6 text-center text-sm text-gray-500 animate-fade-in"
            style="animation-delay: 0.6s"
          >
            ¿Necesitas ayuda?
            <a
              href="mailto:support@webcontrol.com"
              class="font-semibold text-gray-700 hover:text-gray-900 underline"
            >
              Contacta al soporte
            </a>
          </p>
        </div>
      </section>
    </div>

    <!-- Toast Notification -->
    <div
      id="toast"
      class="fixed bottom-6 right-6 hidden transform transition-all duration-300"
    >
      <div
        class="bg-gray-900 text-white px-6 py-4 rounded-2xl shadow-2xl flex items-center space-x-3 border border-gray-700"
      >
        <div
          class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center"
        >
          <i class="fas fa-check text-white"></i>
        </div>
        <span class="font-medium" id="toastMessage"></span>
      </div>
    </div>

    <script>
      const loginAlert = document.getElementById("loginAlert");
      const alertMessage = document.getElementById("alertMessage");
      const loginButton = document.getElementById("loginButton");
      const loginSpinner = document.getElementById("loginSpinner");
      const loginButtonText = document.getElementById("loginButtonText");
      const toast = document.getElementById("toast");
      const toastMessage = document.getElementById("toastMessage");

      // Redirect if already logged in
      if (localStorage.getItem("token")) {
        window.location.href = "/dashboard";
      }

      // Toggle password visibility
      document
        .getElementById("togglePassword")
        .addEventListener("click", () => {
          const passwordInput = document.getElementById("password");
          const icon = document.querySelector("#togglePassword i");
          const isVisible = passwordInput.type === "text";

          passwordInput.type = isVisible ? "password" : "text";
          icon.classList.toggle("fa-eye");
          icon.classList.toggle("fa-eye-slash");
        });

      function setLoading(state) {
        loginButton.disabled = state;
        loginSpinner.classList.toggle("hidden", !state);
        loginButtonText.classList.toggle("hidden", state);

        if (state) {
          loginButton.classList.add("opacity-90", "cursor-not-allowed");
        } else {
          loginButton.classList.remove("opacity-90", "cursor-not-allowed");
        }
      }

      function showAlert(message) {
        alertMessage.textContent = message;
        loginAlert.classList.remove("hidden");

        // Auto hide after 5 seconds
        setTimeout(() => {
          loginAlert.classList.add("hidden");
        }, 5000);
      }

      function showToast(message, type = "success") {
        toastMessage.textContent = message;
        toast.classList.remove("hidden");

        // Change color based on type
        const toastDiv = toast.querySelector("div");
        if (type === "success") {
          toastDiv.className =
            "bg-gray-900 text-white px-6 py-4 rounded-2xl shadow-2xl flex items-center space-x-3 border border-gray-700";
        } else {
          toastDiv.className =
            "bg-red-600 text-white px-6 py-4 rounded-2xl shadow-2xl flex items-center space-x-3 border border-red-700";
        }

        // Animation
        setTimeout(() => {
          toast.style.transform = "translateY(-10px)";
        }, 10);

        setTimeout(() => {
          toast.style.transform = "translateY(0)";
          setTimeout(() => {
            toast.classList.add("hidden");
          }, 300);
        }, 3000);
      }

      // Form submission
      document
        .getElementById("loginForm")
        .addEventListener("submit", async (event) => {
          event.preventDefault();
          loginAlert.classList.add("hidden");
          setLoading(true);

          const formData = new FormData(event.target);

          try {
            const response = await fetch("/api/login", {
              method: "POST",
              body: formData,
            });

            const data = await response.json();

            if (response.ok) {
              const user = data.user || {};
              // Store credentials
              localStorage.setItem("token", data.access_token);
              localStorage.setItem("email", user.email || "");
              localStorage.setItem("role", user.role || "");
              if (user.site_id) {
                localStorage.setItem("site_id", user.site_id);
              } else {
                localStorage.removeItem("site_id");
              }
              localStorage.setItem("user_payload", JSON.stringify(user));

              if (document.getElementById("rememberMe").checked) {
                localStorage.setItem("remember_login", "true");
              }

              // Show success message
              showToast("✓ Autenticación exitosa", "success");

              // Redirect after short delay
              setTimeout(() => {
                window.location.href = "/dashboard";
              }, 800);
            } else {
              showAlert(
                data.detail ||
                  "Credenciales inválidas. Por favor, verifica tu correo y contraseña."
              );
              setLoading(false);
            }
          } catch (error) {
            console.error("Login error:", error);
            showAlert(
              "No se pudo conectar con el servidor. Por favor, verifica tu conexión e intenta nuevamente."
            );
            setLoading(false);
          }
        });

      // Enter key support
      document.addEventListener("keypress", (e) => {
        if (e.key === "Enter" && !loginButton.disabled) {
          document
            .getElementById("loginForm")
            .dispatchEvent(new Event("submit"));
        }
      });
    </script>
  </body>
</html>
